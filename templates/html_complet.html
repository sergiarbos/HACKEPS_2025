<!DOCTYPE html>
<html lang="ca">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Formulari ‚Äî GOT</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Tipografia -->
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0 0 90px 0; /* espai per al men√∫ inferior */
            font-size: 110%;
            text-align: center;
            font-family: 'Marcellus', serif;
            color: white;
            text-shadow: 1px 1px 3px black;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* FONS PER CADA BLOC (CASA) */
        body.bloc1 { background-image: url("{% static 'baratheon.png' %}"); }
        body.bloc2 { background-image: url("{% static 'lannister.png' %}"); }
        body.bloc3 { background-image: url("{% static 'targaryen.png' %}"); }
        body.bloc4 { background-image: url("{% static 'stark.png' %}"); }

        /* üè† ICONA HOME */
        .home-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
        }

        .home-btn img {
            width: 45px;
            height: auto;
            cursor: pointer;
            transition: transform 0.2s;
            filter: invert(100%);
        }

        .home-btn img:hover {
            transform: scale(1.1);
        }

        h1 {
            font-size: 200%;
            margin-top: 60px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        h2.subtitol {
            font-size: 150%;
            margin-bottom: 10px;
            padding-bottom: 3px;
            border-bottom: 2px solid rgba(255,255,255,0.8);
            display: inline-block;
        }

        h3 {
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 115%;
        }

        select {
            background-color: rgba(255,255,255,0.9);
            color: black;
        }

        .screen {
            display: none;
        }

        /* MEN√ö INFERIOR */
        .menu-inferior {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #dce3e8;
            display: flex;
            justify-content: space-around;
            border-top: 2px solid #c3ccd3;
            z-index: 999;
        }

        .menu-inferior a {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            color: black;
            border-right: 1px solid #c3ccd3;
        }

        .menu-inferior a:last-child {
            border-right: none;
        }

        /* COLORS DEL BLOC ACTIU (OPCI√ì A) */
        body.bloc1 .menu-inferior a[data-bloc="1"],
        body.bloc2 .menu-inferior a[data-bloc="2"],
        body.bloc3 .menu-inferior a[data-bloc="3"],
        body.bloc4 .menu-inferior a[data-bloc="4"] {
            background-color: #d3a007; /* daurat GOT */
            color: white;
            text-shadow: 1px 1px 2px black;
        }

        /* COLORS ESPECIALS PER T√çTOLS PER CASA */
        body.bloc1 h2.subtitol { border-color: #ffdd55; color: #ffdd55; }
        body.bloc2 h2.subtitol { border-color: #ffd700; color: #ffd700; }
        body.bloc3 h2.subtitol { border-color: #ff4b4b; color: #ff4b4b; }
        body.bloc4 h2.subtitol { border-color: #bfc7ce; color: #ffffff; }

        /* BOT√ì FINAL BLOC 4 */
        .contenedor-boton {
            margin-top: 20px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            h1 { font-size: 170%; }
            h2.subtitol { font-size: 130%; }
            h3 { font-size: 105%; }
            .menu-inferior a { font-size: 14px; padding: 8px 0; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 150%; }
            h2.subtitol { font-size: 120%; }
            h3 { font-size: 100%; }
            .menu-inferior a { font-size: 12px; padding: 6px 0; }
        }
    </style>
</head>
<body class="bloc1">

    <!-- üè† HOME -->
    <a href="paginaboto.html" class="home-btn">
        <img src="{% static 'home.png' %}" alt="Home">
    </a>

    <h1>Formulari de usuari</h1>

    <!-- üîπ BLOC 1 ‚Äî DEMOGRAFIA -->
    <section class="screen" data-bloc="1">
        <h2 class="subtitol">Bloc 1 ‚Äî Demografia</h2>

        <form action="/resultat/" method="POST">
            {% csrf_token %}
        
            <h3>Renda mitjana de la zona que busques</h3>
            <select name="renda_mediana" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="baixa">Baixa (zones m√©s assequibles)</option>
                <option value="mitjana">Mitjana</option>
                <option value="alta">Alta (zones m√©s cares)</option>
            </select>

            <h3>Densitat de poblaci√≥ preferida</h3>
            <select name="densitat_poblacio" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="baixa">Baixa (m√©s tranquil¬∑la, menys gent)</option>
                <option value="mitjana">Mitjana</option>
                <option value="alta">Alta (m√©s vida, m√©s gent)</option>
            </select>

            <h3>Edat mitjana del barri que prefereixes</h3>
            <select name="edat_mediana" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="jove">Perfil jove</option>
                <option value="mitjana">Edats diverses</option>
                <option value="envellida">Perfil m√©s adult/afian√ßat</option>
            </select>
        </form>
    </section>

    <!-- üîπ BLOC 2 ‚Äî ESTIL DE VIDA I ENTORN -->
    <section class="screen" data-bloc="2">
        <h2 class="subtitol"><b>Bloc 2 ‚Äî Estil de vida i entorn</b></h2>

        <form>
            <h3>Oferta gastron√≤mica (restaurants, bars, caf√®s)</h3>
            <select name="oferta_gastronomica" class="form-select form-select-lg mb-3" style="max-width: 300px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="escassa">Escassa (no √©s prioritari)</option>
                <option value="moderada">Moderada</option>
                <option value="molt_alta">Molt alta (vull molta oferta)</option>
            </select>

            <h3>Zones verdes i parcs</h3>
            <select name="zones_verdes" class="form-select form-select-lg mb-3" style="max-width: 300px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="poques">Poques (no √©s clau)</option>
                <option value="algunes">Algunes</option>
                <option value="moltes">Moltes (vull molta natura)</option>
            </select>

            <h3>Oferta cultural (cinemes, teatres, museus...)</h3>
            <select name="oferta_cultural" class="form-select form-select-lg mb-3" style="max-width: 300px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="baixa">Baixa (no √©s una prioritat)</option>
                <option value="mitjana">Mitjana</option>
                <option value="alta">Alta (vull molta activitat cultural)</option>
            </select>

            <h3>Sensibilitat al soroll</h3>
            <select name="soroll_sensibilitat" class="form-select form-select-lg mb-3" style="max-width: 300px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="indiferent">Indiferent (puc tolerar soroll)</option>
                <option value="moderat">Prefereixo una zona moderadament tranquil¬∑la</option>
                <option value="molt_sensible">Molt sensible al soroll (busco m√†xima tranquil¬∑litat)</option>
            </select>
        </form>
    </section>

    <!-- üîπ BLOC 3 ‚Äî MOBILITAT -->
    <section class="screen" data-bloc="3">
        <h2 class="subtitol">Bloc 3 ‚Äî Mobilitat</h2>

        <form>
            <h3>Acc√©s general al transport p√∫blic</h3>
            <select name="transport_public" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="baix">Baix (no √©s tan important)</option>
                <option value="bo">Bo</option>
                <option value="excel¬∑lent">Excel¬∑lent (vull moltes opcions)</option>
            </select>

            <h3>Freq√º√®ncia i cobertura de bus/metro</h3>
            <select name="metro_bus" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="limitada">Limitada</option>
                <option value="correcta">Correcta</option>
                <option value="molt_abundant">Molt abundant</option>
            </select>

            <h3>Carrils bici i infraestructura ciclista</h3>
            <select name="carrils_bici" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="inexistent">Inexistent (no ho tinc en compte)</option>
                <option value="basic">B√†sic</option>
                <option value="extens">Extens (vull bona xarxa ciclista)</option>
            </select>

            <h3>Caminabilitat (poder fer vida a peu)</h3>
            <select name="caminabilitat" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="baixa">Baixa</option>
                <option value="mitjana">Mitjana</option>
                <option value="alta">Alta (vull fer molta vida caminant)</option>
            </select>
        </form>
    </section>

    <!-- üîπ BLOC 4 ‚Äî PERFIL D‚ÄôUSUARI -->
    <section class="screen" data-bloc="4">
        <h2 class="subtitol">Bloc 4 ‚Äî Perfil de l‚Äôusuari</h2>

        <form>
            <h3>Nivell de seguretat requerit</h3>
            <select name="seguretat_requerida" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="estandard">Est√†ndard (nivell normal)</option>
                <option value="alta">Alta</option>
                <option value="molt_alta">Molt alta (prioritat m√†xima)</option>
            </select>

            <h3>Prioritat principal</h3>
            <select name="prioritat" class="form-select form-select-sm mb-2" style="max-width: 260px; margin:auto;">
                <option selected disabled>Selecciona una opci√≥</option>
                <option value="comunitat">Comunitat i vida de barri</option>
                <option value="privacitat_luxe">Privacitat i luxe</option>
                <option value="accessibilitat">Accessibilitat i mobilitat</option>
                <option value="cultura">Cultura, oci i gastronomia</option>
            </select>
        </form>

        <div class="contenedor-boton">
            <!--
            <button class="btn btn-success btn-lg fw-bold" onclick="window.location.href='pantalla_final.html'">
                TROBA ZONA
            </button>
            --->
            <button type="submit" class="btn btn-success btn-lg fw-bold">
                TROBA ZONA
            </button>                   
        </div>
    </section>

    <!-- MEN√ö INFERIOR -->
    <nav class="menu-inferior">
        <a href="#" data-bloc="1">Bloc 1</a>
        <a href="#" data-bloc="2">Bloc 2</a>
        <a href="#" data-bloc="3">Bloc 3</a>
        <a href="#" data-bloc="4">Bloc 4</a>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const body = document.body;
            const screens = document.querySelectorAll('.screen');
            const menuLinks = document.querySelectorAll('.menu-inferior a');

            function activateBloc(num) {
                // canvi classe del body per canviar fons i color men√∫
                body.classList.remove('bloc1', 'bloc2', 'bloc3', 'bloc4');
                body.classList.add('bloc' + num);

                // mostrar/amagar pantalles
                screens.forEach(sec => {
                    sec.style.display = (sec.dataset.bloc === String(num)) ? 'block' : 'none';
                });
            }

            // enlla√ßos del men√∫
            menuLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const blocNum = this.dataset.bloc;
                    activateBloc(blocNum);
                });
            });

            // bloc inicial
            activateBloc(1);
        });
    </script>

    <script>
        async function enviarRespostes() {
            // Llista dels "name" dels teus <select>
            const fields = [
                "renda_mediana",
                "densitat_poblacio",
                "edat_mediana",
                "oferta_gastronomica",
                "zones_verdes",
                "oferta_cultural",
                // aquesta no la tens encara al formulari, la pots afegir despr√©s:
                // "soroll_sensibilitat",
                "transport_public",
                "metro_bus",
                "carrils_bici",
                "caminabilitat",
                "seguretat_requerida",
                "prioritat"
            ];

            const answers = {};

            fields.forEach(name => {
                const el = document.querySelector(`select[name="${name}"]`);
                if (!el) return;
                const value = el.value;
                if (value && !value.startsWith("Selecciona")) {
                    answers[name] = value;
                }
            });

            // Opcional: validar que tot est√† contestat
            // if (Object.keys(answers).length < fields.length) { ... }

            try {
                const res = await fetch("/api/recommend", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(answers)
                });

                if (!res.ok) {
                    alert("Error al servidor. Torna-ho a provar m√©s tard.");
                    return;
                }

                const data = await res.json();

                // guardem els resultats en localStorage per poder-los llegir a pantalla_final.html
                localStorage.setItem("recom_resultats", JSON.stringify(data.results));

                // anem a la pantalla final
                window.location.href = "pantalla_final.html";

            } catch (err) {
                console.error(err);
                alert("No s'ha pogut connectar amb el servidor.");
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // ja tens el codi dels blocs aqu√≠...

            const btn = document.getElementById("btnTrobaZona");
            if (btn) {
                btn.addEventListener("click", function (e) {
                    e.preventDefault();
                    enviarRespostes();
                });
            }
        });
    </script>

</body>
</html>
